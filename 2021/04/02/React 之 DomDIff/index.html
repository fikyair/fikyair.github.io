<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="Ignite&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      React ä¹‹ dom-diff | Ignite
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    <script src="/js/qrious.js"></script>
  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Ignite</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>React ä¹‹ dom-diff</h2>
  <p class="post-date">2021-04-02</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h2 id="dom-diffç®—æ³•">DOM-DIFFç®—æ³•</h2>
<p>åœ¨ <code>React17+</code> ä¸­ <code>DOM-DIFF</code> å°±æ˜¯æ ¹æ®è€çš„ <code>fiberæ ‘</code> å’Œæœ€æ–°çš„ <code>JSX</code> å¯¹æ¯”ç”Ÿæˆæ–°çš„ <code>fiberæ ‘</code> çš„è¿‡ç¨‹</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªè€çš„æ ‘å˜æˆä¸€ä¸ªæ–°çš„æ ‘ï¼Œç®—æ³•å®ç°çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n^3)ï¼Œæ€§èƒ½è¾ƒå·®</p>
<h3 id="reactä¼˜åŒ–åŸåˆ™">Reactä¼˜åŒ–åŸåˆ™</h3>
<ul>
<li>åªå¯¹åŒçº§èŠ‚ç‚¹è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœ DOM èŠ‚ç‚¹è·¨å±‚çº§ç§»åŠ¨ï¼Œåˆ™ React ä¸ä¼šå¤ç”¨</li>
<li>ä¸åŒç±»å‹ type çš„å…ƒç´ ä¼šäº§å‡ºä¸åŒçš„ç»“æ„ï¼Œä¼šé”€æ¯è€ç»“æ„ï¼Œåˆ›å»ºæ–°ç»“æ„</li>
<li>å¯ä»¥é€šè¿‡ key æ ‡è¯†ç§»åŠ¨çš„å…ƒç´ </li>
</ul>
<h3 id="å•èŠ‚ç‚¹">å•èŠ‚ç‚¹</h3>
<ul>
<li>å¦‚æœæ–°çš„èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªçš„è¯</li>
</ul>
<p><img src="https://blog-1253646934.cos.ap-beijing.myqcloud.com/singleFiber.jpeg" alt="singleFiber"></p>
<h4 id="case-1">case 1</h4>
<p>æ–°æ—§èŠ‚ç‚¹ typeä¸åŒï¼Œå¦‚æœèŠ‚ç‚¹æ²¡æœ‰å†™ keyï¼Œkey å°±æ˜¯ç´¢å¼• ï¼ˆkey=â€œ0â€ï¼‰</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>h1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>    åœ¨è°ƒå’Œé˜¶æ®µï¼Œéœ€è¦æŠŠè¿™ä¸ªè€èŠ‚ç‚¹æ ‡è®°ä¸ºåˆ é™¤</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">/*************/</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>    ç”Ÿæˆæ–°çš„ fiber èŠ‚ç‚¹å¹¶æ ‡è®°ä¸ºæ’å…¥</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ commit é˜¶æ®µï¼Œremove h1ï¼ŒappendChild h2</p>
<h4 id="case-2">case 2</h4>
<p>æ–°æ—§èŠ‚ç‚¹ type å’Œ key éƒ½ä¸ä¸€æ ·</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">key</span>=<span class="string">"h1"</span>&gt;</span>h1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">key</span>=<span class="string">"h2"</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">key</span>=<span class="string">"h3"</span>&gt;</span>h3<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">key</span>=<span class="string">"h4"</span>&gt;</span>h4<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">/*************/</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">key</span>=<span class="string">"h2"</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åªéœ€ h1 æ ‡è®°ä¸ºåˆ é™¤<br>
h3 h4 æ ‡è®°ä¸ºåˆ é™¤</p>
<h4 id="case-3">case 3</h4>
<p>typeå’Œkeyéƒ½ç›¸åŒ</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">key</span>=<span class="string">"h1"</span>&gt;</span>h1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">/*************/</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">key</span>=<span class="string">"h1"</span>&gt;</span>h1-new<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœå¯¹æ¯”åå‘ç°æ–°è€èŠ‚ç‚¹ä¸€æ ·çš„ï¼Œé‚£ä¹ˆä¼šå¤ç”¨è€èŠ‚ç‚¹ï¼Œå¤ç”¨è€èŠ‚ç‚¹çš„DOMå…ƒç´ å’ŒFiberå¯¹è±¡</p>
<p>å†çœ‹å±æ€§æœ‰æ— å˜æ›´ï¼Œå¦‚æœæœ‰å˜åŒ–ï¼Œåˆ™ä¼šæŠŠæ­¤FiberèŠ‚ç‚¹æ ‡å‡†ä¸ºæ›´æ–°</p>
<p><code>h1.innerHTML = 'h1-new';</code></p>
<h4 id="case-4">case 4</h4>
<p>key ç›¸åŒä½†æ˜¯ type ä¸åŒï¼Œç›´æ¥åˆ é™¤æ‰€æœ‰è€èŠ‚ç‚¹</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">key</span>=<span class="string">"h1"</span>&gt;</span>h1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">key</span>=<span class="string">"h2"</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">/*************/</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">key</span>=<span class="string">"h1"</span>&gt;</span>p<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœkeyç›¸åŒï¼Œä½†æ˜¯typeä¸åŒï¼Œåˆ™ä¸å†è¿›è¡Œåç»­å¯¹æ¯”äº†ï¼Œ</p>
<p>ç›´æ¥æŠŠè€çš„èŠ‚ç‚¹å…¨éƒ¨åˆ é™¤</p>
<p>æ’å…¥æ–°èŠ‚ç‚¹å³å¯</p>
<h3 id="å¤šèŠ‚ç‚¹">å¤šèŠ‚ç‚¹</h3>
<ul>
<li>å¦‚æœæ–°çš„èŠ‚ç‚¹æœ‰å¤šä¸ªèŠ‚ç‚¹çš„è¯</li>
<li>èŠ‚ç‚¹æœ‰å¯èƒ½æ›´æ–°ã€åˆ é™¤ã€æ–°å¢</li>
<li>å¤šèŠ‚ç‚¹çš„æ—¶å€™ä¼šç»å†äºŒè½®éå†</li>
<li>ç¬¬ä¸€è½®éå†ä¸»è¦æ˜¯å¤„ç†èŠ‚ç‚¹çš„æ›´æ–°,æ›´æ–°åŒ…æ‹¬å±æ€§å’Œç±»å‹çš„æ›´æ–°</li>
<li>ç¬¬äºŒè½®éå†ä¸»è¦å¤„ç†èŠ‚ç‚¹çš„æ–°å¢ã€åˆ é™¤å’Œç§»åŠ¨</li>
<li>ç§»åŠ¨æ—¶çš„åŸåˆ™æ˜¯å°½é‡å°‘é‡çš„ç§»åŠ¨ï¼Œå¦‚æœå¿…é¡»æœ‰ä¸€ä¸ªè¦åŠ¨ï¼Œæ–°åœ°ä½é«˜çš„ä¸åŠ¨ï¼Œæ–°åœ°ä½ä½çš„åŠ¨</li>
</ul>
<p>å¦‚æœæ–°çš„èŠ‚ç‚¹æœ‰å¤šä¸ªçš„è¯<br>
æˆ‘ä»¬ç»è¿‡äºŒè½®éå†</p>
<ol>
<li>
<p>ç¬¬ä¸€è½®å¤„ç†æ›´æ–°çš„æƒ…å†µ å±æ€§å’Œç±»å‹ type çš„æ›´æ–°ï¼Œæ›´æ–°æˆ–è€…è¯´ä¿æŒï¼Œä¸å˜çš„é¢‘ç‡ä¼šæ¯”è¾ƒé«˜ï¼Œ<br>
è‹¥å¤„ç† åˆ é™¤/ç§»åŠ¨ çš„è¯ï¼ŒèŠ‚ç‚¹çš„ä½ç½®ä¼šæœ‰å˜åŒ–ï¼Œä¸åˆ©äº diff</p>
</li>
<li>
<p>ç¬¬äºŒè½®å¤„ç†æ–°å¢ åˆ é™¤  ç§»åŠ¨ çš„æƒ…å†µ</p>
</li>
</ol>
<h4 id="case1">case1</h4>
<p>ä¸€ä¸€å¯¹æ¯”ï¼Œéƒ½å¯å¤ç”¨ï¼Œåªéœ€æ›´æ–°</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"A"</span>&gt;</span>A<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"B"</span>&gt;</span>B<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"C"</span>&gt;</span>C<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"D"</span>&gt;</span>D<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">/*************/</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"A"</span>&gt;</span>A-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"B"</span>&gt;</span>B-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"C"</span>&gt;</span>C-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"D"</span>&gt;</span>D-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ€åä¼šå¾—åˆ°ä¸€ä¸ªæ“ä½œæ­¥éª¤ï¼š</p>
<ol>
<li>æ›´æ–°A</li>
<li>æ›´æ–°B</li>
<li>æ›´æ–°C</li>
<li>æ›´æ–°D</li>
</ol>
<h4 id="case2">case2</h4>
<p>ä¸€ä¸€å¯¹æ¯”ï¼Œkey ç›¸åŒï¼Œtype ä¸åŒï¼Œåˆ é™¤è€çš„ï¼Œæ·»æ–°çš„</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"A"</span>&gt;</span>A<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"B"</span>&gt;</span>B<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"C"</span>&gt;</span>C<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"D"</span>&gt;</span>D<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">/*************/</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"A"</span>&gt;</span>A-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"B"</span>&gt;</span>B-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"C"</span>&gt;</span>C-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"D"</span>&gt;</span>D-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ é™¤è€ li A<br>
æ’å…¥ div A<br>
æ›´æ–° B æ›´æ–° C æ›´æ–° D</p>
<h4 id="case3">case3</h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"A"</span>&gt;</span>A<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"B"</span>&gt;</span>B<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"C"</span>&gt;</span>C<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"D"</span>&gt;</span>D<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">/*************/</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"A"</span>&gt;</span>A-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"C"</span>&gt;</span>C-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"D"</span>&gt;</span>D-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"B"</span>&gt;</span>B-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ›´æ–°A</p>
<p>key ä¸ä¸€æ ·ï¼Œè¯´æ˜å¯èƒ½æœ‰ä½ç½®å˜åŒ–</p>
<p><strong>å¦‚æœç¬¬ä¸€è½®éå†çš„æ—¶å€™ï¼Œå‘ç° key ä¸ä¸€æ ·ï¼Œåˆ™ç«‹åˆ»è·³å‡ºç¬¬ä¸€è½®å¾ªç¯</strong></p>
<p>ä¸‹é¢è¯¦ç»†è¯´ä¸€ä¸‹ï¼š</p>
<p>åœ¨ react æºç ä¸­ï¼Œæ¯ä¸ªæ“ä½œéƒ½æœ‰ä¸€ä¸ªæ ‡è¯†ï¼Œç§°ä¹‹ä¸º Effect.Tag</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Placement = <span class="comment">/*             */</span> <span class="number">0b0000000000010</span>  --&gt;<span class="number">2</span>  æ’å…¥æ“ä½œ</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Update = <span class="comment">/*                */</span> <span class="number">0b0000000000100</span>  --&gt;<span class="number">4</span>  æ›¿æ¢æ“ä½œ</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PlacementAndUpdate = <span class="comment">/*    */</span> <span class="number">0b0000000000110</span>  --&gt;<span class="number">6</span>  æ›´æ–°æ“ä½œ</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Deletion = <span class="comment">/*              */</span> <span class="number">0b0000000001000</span>  --&gt;<span class="number">8</span>  åˆ é™¤æ“ä½œ</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"A"</span> &gt;</span>A<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"B"</span> &gt;</span>B<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"C"</span> &gt;</span>C<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"D"</span> &gt;</span>D<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"E"</span> &gt;</span>E<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"F"</span> &gt;</span>F<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ›´æ–°ä¸ºï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"A"</span>  &gt;</span>A-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"C"</span>  &gt;</span>C-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"E"</span>  &gt;</span>E-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"B"</span>  &gt;</span>B-new<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"G"</span>  &gt;</span>G<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>lasPlacedIndex</code> æœ€åæ”¾ç½®çš„è€çš„èŠ‚ç‚¹çš„æŒ‚è½½çš„ç´¢å¼•ä½ç½®</p>
<p><code>oldIndex</code> èŠ‚ç‚¹åœ¨è€é›†åˆä¸­çš„ç´¢å¼•ä½ç½®</p>
<p><code>newIndex</code> èŠ‚ç‚¹åœ¨æ–°é›†åˆä¸­çš„ç´¢å¼•ä½ç½®</p>
<ol>
<li>ç¬¬ä¸€è½®å¾ªç¯<br>
type å’Œ key éƒ½ä¸€æ · A èƒ½å¤ç”¨ï¼Œæ›´æ–° A å°±å¯ä»¥ï¼Œ</li>
</ol>
<p>ç„¶åæ¯”è¾ƒç¬¬äºŒä¸ªå…ƒç´ ï¼ŒKey ä¸ä¸€æ ·ï¼Œåˆ™é©¬ä¸Šè·³å‡ºç¬¬ä¸€è½®å¾ªç¯ï¼Œè¿›å…¥ç¬¬äºŒè½®å¾ªç¯</p>
<ol start="2">
<li>ç¬¬äºŒè½®å¾ªç¯</li>
</ol>
<p>æ–°å»º mapï¼š key å°±æ˜¯å…ƒç´ çš„ keyï¼Œå€¼å°±æ˜¯è€çš„ fiber èŠ‚ç‚¹ <code>let map = {'B':B,'C':C,'D':D,'E':E,'F':F};</code><br>
<img class="emoji" draggable="false" alt="ğŸ˜„" src="https://twemoji.maxcdn.com/2/72x72/1f604.png">,<br>
æ¯å½“å¤„ç†å®Œä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±ä» map ä¸­åˆ é™¤ï¼Œ<br>
ç­‰æ–°çš„ JSX æ•°ç»„éå†å®Œä¹‹åï¼Œ<code>map = {'D':D,'F':F}</code>ï¼ŒæŠŠ map é‡Œé¢çš„ Fiber èŠ‚ç‚¹å…¨éƒ¨æ ‡è®°ä¸º <code>Deletion</code>ï¼Œä¹Ÿå°±æ˜¯ D å’Œ F ;</p>
<p>ç»§ç»­éå†æ–°çš„èŠ‚ç‚¹</p>
<ul>
<li>
<p>å½“éå†åˆ° C çš„æ—¶å€™ï¼Œä» è€çš„é›†åˆ ä¸­æ‰¾ï¼Œæ˜¯å¦èƒ½æ‰¾åˆ° C</p>
<p>å‘ç°æ‰¾åˆ°äº†ï¼ŒC çš„ (oldIndex = 2) &gt; (lastPlacedIndex = 0)</p>
<p>C çš„ä½ç½®ä¸éœ€è¦ç§»åŠ¨ã€‚effectTag æ ‡è®°ä¸º <code>Update</code>ï¼Œå¦å¤–ä» map ä¸­åˆ é™¤ Cï¼Œå› ä¸º C å¯ä»¥å¤ç”¨</p>
<p>lastPlacedIndex = 2ï¼Œ2 å°±æ˜¯ C åœ¨è€é›†åˆä¸­çš„ä½ç½® oldIndex</p>
</li>
<li>
<p>å½“éå†åˆ° E çš„æ—¶å€™ï¼Œä» è€çš„é›†åˆ ä¸­æ‰¾ï¼Œæ˜¯å¦èƒ½æ‰¾åˆ° E</p>
<p>å‘ç°æ‰¾åˆ°äº†ï¼ŒE åœ¨è€é›†åˆä¸­çš„ä½ç½® (oldIndex = 4) &gt; (lastPlacedIndex = 2)</p>
<p>E çš„ä½ç½®ä¸éœ€è¦ç§»åŠ¨ï¼ŒeffectTag æ ‡è®°ä¸º <code>Update</code></p>
<p>lastPlacedIndex = 4ï¼Œ4 å°±æ˜¯ E åœ¨è€é›†åˆä¸­çš„ä½ç½® oldIndex</p>
</li>
<li>
<p>å½“éå†åˆ° B çš„æ—¶å€™ï¼Œä» è€çš„é›†åˆ ä¸­æ‰¾ï¼Œæ˜¯å¦èƒ½æ‰¾åˆ° B</p>
<p>å‘ç°æ‰¾åˆ°äº†ï¼ŒB åœ¨è€é›†åˆä¸­çš„ä½ç½® (oldIndex = 1) &lt; (lastPlacedIndex = 4)ï¼Œ</p>
<p>è¾›è‹¦æŒªåŠ¨ä¸‹ä½ç½®ï¼ˆå› ä¸º B åœ¨æ–°çš„é›†åˆä¸­çš„ä½ç½®æ¯”è¾ƒé åï¼‰</p>
<p>B å‘åç§»åŠ¨åˆ° E çš„åé¢ï¼ŒeffectTag æ ‡è®°ä¸º <code>PlacementAndUpdate</code></p>
</li>
<li>
<p>å½“éå†åˆ° G çš„æ—¶å€™ï¼Œä» è€çš„é›†åˆ ä¸­æ‰¾ï¼Œæ˜¯å¦èƒ½æ‰¾åˆ° G</p>
<p>æ²¡æœ‰æ‰¾åˆ°ï¼ŒeffectTag æ ‡è®°ä¸º <code>Placement</code></p>
</li>
<li>
<p>å‘ç° map é›†åˆä¸­è¿˜æœ‰ D å’Œ Fï¼Œä½†æ–°çš„é›†åˆä¸­æ²¡æœ‰ D å’Œ Fï¼ŒeffectTag æ ‡è®°ä¸º <code>Deletion</code></p>
</li>
</ul>
<p>åœ¨ commit é˜¶æ®µï¼Œå…ˆæ‰§è¡Œ Deletion æ ‡è®°çš„æ“ä½œï¼Œå†æ‰§è¡Œå…¶ä»–æ“ä½œã€‚ä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>diff é˜¶æ®µå¯ä»¥æš‚åœï¼Œæ²¡æœ‰æ—¶é—´ç‰‡äº†å°±äº¤è¿˜æ§åˆ¶æƒã€‚</p>
<p><img src="https://blog-1253646934.cos.ap-beijing.myqcloud.com/diff%E7%AE%97%E6%B3%95.jpeg" alt="diffç®—æ³•"></p>
<h3 id="ä¸ºä»€ä¹ˆä¸è¦ç”¨ç´¢å¼•ä½œä¸ºkey">ä¸ºä»€ä¹ˆä¸è¦ç”¨ç´¢å¼•ä½œä¸ºkey</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"A"</span> &gt;</span>A<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"B"</span> &gt;</span>B<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"C"</span> &gt;</span>C<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"D"</span> &gt;</span>D<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">æ›´æ–°ä¸º</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"B"</span> &gt;</span>B<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"C"</span> &gt;</span>C<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"D"</span> &gt;</span>D<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"A"</span> &gt;</span>A<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœç”¨ç´¢å¼•å¯¹æ¯”çš„è¯</p>
<p>A-B<br>
B-C<br>
C-D<br>
D-A</p>
<p>åˆ é™¤æ‰€æœ‰è€ DOMï¼Œå…¨éƒ¨æ·»åŠ æ–° DOM</p>
<p>å¦‚æœç”¨ key æ¥æ¯”è¾ƒï¼Œåªéœ€ç§»åŠ¨ A åˆ°æœ€åå°±è¡Œäº†ã€‚</p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#React" >
    <span class="tag-code">React</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2021/02/23/Babel åŸç†ä¹‹AST/">
        <span class="nav-arrow">â† </span>
        
          ã€ŒBabel åŸç†ä¹‹ã€AST
        
      </a>
    
    
  </div>

    <!-- NAV END -->
    <!-- æ‰“èµ START -->
    
      <div class="money-like">
        <div class="reward-btn">
          èµ
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>ä½¿ç”¨æ”¯ä»˜å®æ‰“èµ</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>ä½¿ç”¨å¾®ä¿¡æ‰“èµ</b>
            </span>
          </span>
        </div>
        <p class="notice">è‹¥ä½ è§‰å¾—æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¯¹æˆ‘æ‰“èµ</p>
      </div>
    
    <!-- æ‰“èµ END -->
    <!-- äºŒç»´ç  START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">æ‰«æäºŒç»´ç ï¼Œåˆ†äº«æ­¤æ–‡ç« </p>
      </div>
    
    <!-- äºŒç»´ç  END -->
    
      <!-- Disqus START -->
      <div id="disqus_thread"></div>
      <!-- Disqus END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#dom-diffç®—æ³•"><span class="toc-nav-text">DOM-DIFFç®—æ³•</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#reactä¼˜åŒ–åŸåˆ™"><span class="toc-nav-text">Reactä¼˜åŒ–åŸåˆ™</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#å•èŠ‚ç‚¹"><span class="toc-nav-text">å•èŠ‚ç‚¹</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#case-1"><span class="toc-nav-text">case 1</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#case-2"><span class="toc-nav-text">case 2</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#case-3"><span class="toc-nav-text">case 3</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#case-4"><span class="toc-nav-text">case 4</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#å¤šèŠ‚ç‚¹"><span class="toc-nav-text">å¤šèŠ‚ç‚¹</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#case1"><span class="toc-nav-text">case1</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#case2"><span class="toc-nav-text">case2</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#case3"><span class="toc-nav-text">case3</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#ä¸ºä»€ä¹ˆä¸è¦ç”¨ç´¢å¼•ä½œä¸ºkey"><span class="toc-nav-text">ä¸ºä»€ä¹ˆä¸è¦ç”¨ç´¢å¼•ä½œä¸ºkey</span></a></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://xueshiming.cn/2021/04/02/React ä¹‹ DomDIff/';
    var banner = 'undefined'
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>





  <script>
    var disqus_shortname = 'https-xueshiming-cn';
    
    var disqus_url = 'http://xueshiming.cn/2021/04/02/React ä¹‹ DomDIff/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//go.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2021 | <a href="http://beian.miit.gov.cn" target="_blank">æ´¥ICPå¤‡17005329å·</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>